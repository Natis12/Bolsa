name: ðŸ§¹ Limpieza de Informes Antiguos

on:
  schedule:
    # Se ejecuta todos los dÃ­as a las 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:
    # Permite ejecutarlo manualmente desde la pestaÃ±a Actions

permissions:
  contents: write

jobs:-
  delete-old-reports:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Clonar Repositorio
        uses: actions/checkout@v4

      - name: ðŸ—‘ï¸ Borrar archivos html de mÃ¡s de 30 dÃ­as
        run: |
          # Configurar Git
          git config --global user.name "Limpiador AutomÃ¡tico"
          git config --global user.email "bot@github.com"
          
          # Buscar y borrar archivos informe-*.html mÃ¡s antiguos de 30 dÃ­as
          # -mtime +30 significa "modificado hace mÃ¡s de 30 dÃ­as"
          find . -name "informe-*.html" -type f -mtime +30 -exec rm {} \;
          
          # Verificar si hay cambios para confirmar
          if [[ `git status --porcelain` ]]; then
            echo "Archivos antiguos detectados y borrados locally."
            git add .
            git commit -m "ðŸ§¹ Limpieza automÃ¡tica: Informes > 30 dÃ­as eliminados"
            git push
            echo "âœ… Cambios subidos al repo."
          else
            echo "âœ¨ No hay archivos antiguos para borrar hoy."
          fi
